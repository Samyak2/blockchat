<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="topbar.css">
<meta charset="utf-8">
<title>BlockChat</title>
<style>
#chattop {
  /* border: 1px solid #222222; */
  margin: 5px 10px;
  background-color: #d5f2ff;
  /* overflow: hidden; */
  /* flex: 0 0 10%; */
  box-shadow: 7px 8px #2270ff;
}

#chatmessages {
  flex: 1 0 10%;
  margin: 10px;
  overflow: auto;
  background-color: #dcedff09;
}



div.message.received {
  background-color: lightblue;
  text-align: left;
  float: left;
  box-shadow: 7px 6px blue;
  border: none;
  margin: 10px;
  padding: 11px;
  border-radius: 0px;
  max-width: 60%;
  display: flex;
  flex: 1 1 auto;
  clear: both;
}

div.right {
  flex: 1 0 70%;
  background-color: #ffffff;
  display: flex;
  flex-flow: column nowrap;
  overflow: hidden;
}


div.sent.message {
  background-color: #f7d324;
  float: right;
  box-shadow: 6px 6px #e67246;
  border: none;
  margin: 10px;
  padding: 11px;
  border-radius: 0px;
  max-width: 60%;
  display: flex;
  flex: 1 1 auto;
  clear: both;
}

html, body {
        height: 100%;
        margin: 0;
    }

    #maincontainer {
        display: flex;
        flex-flow: column wrap;
        overflow: hidden;
        height: 100%;
    }

    #main {
        display: flex;
        flex-direction: row;
        flex: 1;
        overflow: hidden;
    }

    div.left {
        flex: 1 0 30%;
        background-color: hsla(240, 7.9%, 53.1%, 0.92);
        overflow: auto;
    }

    div.right {
        flex: 1 0 70%;
        background-color: #ffffff;
        display: flex;
        flex-flow: column nowrap;
        overflow: hidden;
        background-image: url(chat-background.jpg);
        background-size: cover;
    }

    div.chat {
    background-color: #b4d6ff;
    overflow: auto;
    margin: 5px 5px 5px 5px;
    box-shadow: 3px 3px #038bff;
    }

    div.chat:hover {
        box-shadow: 5px 5px 5px #004b8d;
    }


    img.profpic {
        display: inline-block;
        /* float: left; */
        vertical-align: middle;
        height: 50px;
        width: 50px;
        padding: 3px 3px 3px 3px;
        border-radius: 50%;
        border: 1px solid #222222;
        margin: 2px;
    }

    div.personnamerecent {
        /* float: left; */
        display: inline-block;
        vertical-align: middle;
        height: 100%;
        max-width: calc(100% - 70px);
        overflow: hidden;
    }

    p.person {
        margin: 0 0 0 5px;
    }

    p.name {
        font-weight: bold;
    }

    #chattop {
        border: 1px solid #222222;
        margin: 5px 10px;
        /* overflow: hidden; */
        /* flex: 0 0 10%; */
        border-radius: 10px;
    }

    #profpic {
        height: 50px;
        width: 50px;
        display: inline-block;
        vertical-align: middle;
        padding: 5px 5px 5px 5px;
    }

    #personname {
        display: inline-block;
        vertical-align: middle;
    }

    #chatmessages {
        flex: 1 0 10%;
        margin: 10px;
        overflow: auto;
    }

    div.message {
        border: 1px solid #333333;
        margin: 5px;
        padding: 5px;
        border-radius: 10px;
        max-width: 60%;
        display: flex;
        flex: 1 1 auto;
        clear: both;
    }

    div.received {
        background-color: lightblue;
        text-align: left;
        float: left;
    }

    div.sent {
        background-color: lightpink;
        float: right;
    }

    #messageinput {
        width: 100%;
        height: 30px;
        margin: 5px 5px;
        /*! overflow: hidden; */
        vertical-align: middle;
        padding-bottom: 5px;
    }

    #msginputbox {
        display: inline-block;
        width: calc(100% - 50px);
        height: 30px;
        border-radius: 10px;
    }

    #msgsend {
        display: inline-block;
        width: 32px;
        height: 32px;
        vertical-align: top;
        border-radius: 50%;
        background-image: url(send-button.png);
        background-repeat: no-repeat;
        background-position: left;
        /*! padding-left: 30px; */
        background-size: 30px;
        padding: px;
    }

</style>

</head>
<body>
    <div id="maincontainer">
        <ul id="topbar">
            <li id="topbartitle">
                <a href="index.html">Blockchat</a>
            </li>
            <li id="topbarlink">
                <a href="profilepage.html">Username</a>
            </li>
            <li id="topbarlink">
                <a href="aboutus.html">About Us</a>
            </li>
            <li id="topbarlink">
                <a class="active" href="chatpage.html">Chat</a>
            </li>
            <li id="topbarlink">
                <a href="transfer.html">Transfer</a>
            </li>
        </ul>


        <div id="main" style="margin-top: 35px;">
            <div class="column left" id="leftcolumn">
                <button onclick="addchat()" value="AddChat">Add Chat</button>
                <!-- <div class="chat">
                    <img class="profpic" src="chatpage_files/person.png">
                    <div class="personnamerecent">
                        <p class="person name">Person 1</p>
                        <p class="person recentmessage">Hello!</p>
                    </div>
                </div>
                <div class="chat">
                    <img class="profpic" src="chatpage_files/person.png">
                    <div class="personnamerecent">
                        <p class="person name">Person 2</p>
                        <p class="person recentmessage">How are you?</p>
                    </div>
                </div>
                <div class="chat">
                        <img class="profpic" src="chatpage_files/person.png">
                        <div class="personnamerecent">
                            <p class="person name">Person 3</p>
                            <p class="person recentmessage">Hmmmmmmmmmmmmmmmmm</p>
                        </div>
                </div> -->
            </div>
            <div class="column right" id="rightcolumn">
                <center style="height: 100%;">
                    <h3 style="color: aliceblue;height: 100%;position: relative;top: 30%;text-shadow: 1px 1px black;">Select a chat from the left or start a new chat to start messaging</h3>
                </center>
            </div>
        </div>
    </div>
    <script>
        topbar = document.getElementById("topbar");
        var contentPlacement = topbar.getBoundingClientRect().top + topbar.offsetHeight;
        document.getElementById("main").style["margin-top"] = contentPlacement + "px";
    </script>

    <script>
        function addchat()
        {
            person = new Object();
            person.name = "Person X";//prompt("Enter person name:");
            person.recentMessage = "Yo";//prompt("Enter recent message:");
            left_column = document.getElementsByClassName("column left")[0];
            chat = document.createElement("div");
            chat.className = "chat";
            chat_img = document.createElement("img");
            chat_img.className = "profpic";
            chat_img.src = "person.png";
            chat.appendChild(chat_img);
            chat_info = document.createElement("div");
            chat_info.className = "personnamerecent";
            chat_info.innerHTML += "<p class=\"person name\">" + person.name + "</p> <p class=\"person recentmessage\">" + person.recentMessage + "</p>";
            chat.appendChild(chat_info);
            // chat.innerHTML += "<img class=\"profpic\" src=\"person.png\" />";
            // chat.innerHTML += "<div class=\"personnamerecent\">" \
            // "<p class=\"person name\">" + person.name + "</p>" + \
            // <p class=\"person recentmessage\">" + person.recentMessage + "</p>";
            // </div>";
            left_column.appendChild(chat);
        }

        function addMsg() {
            inputbox = document.getElementById("msginputbox");
            msg = inputbox.value;
            newMsg = document.createElement("div");
            newMsg.className = "message sent";
            newMsg.textContent = msg;
            chatmessages = document.getElementById("chatmessages");
            chatmessages.appendChild(newMsg);
            chatmessages.scrollTop = chatmessages.scrollHeight;
            current_person_name = document.getElementById("personname").textContent;
            chats[current_person_name].push([1, msg])
            allchats = document.getElementsByClassName("personnamerecent");
            for(var i=0; i<allchats.length; ++i) {
                if(allchats[i].getElementsByClassName("person name")[0].textContent == current_person_name) {
                    allchats[i].getElementsByClassName("person recentmessage")[0].textContent = msg;
                }
            }
            return false;
        }

        function receiveMsg() {
            inputbox = document.getElementById("msginputbox");
            newMsg = document.createElement("div");
            newMsg.className = "message received";
            newMsg.textContent = inputbox.value;
            chatmessages = document.getElementById("chatmessages");
            chatmessages.appendChild(newMsg);
            chatmessages.scrollTop = chatmessages.scrollHeight;
            return false;
        }

        var chats = {"Person 1": [[1, "Hi"], [2, "Hello"]],
            "Person 2": [[2, "Hello how are you?"], [1, "Hi, I am fine"], [1, "How are you?"]],
            "Rahul": [[1, "Hey"], [1, "What's up?"], [2, "Nothing Much"], [2, "How are you?"], [2, "Where are you?"], [2, "What are you?"], [1, "I'm good"], [1, "I'm in Bangalore"], [1, "I'm a human being"], [1, "Do you need any help?"], [2, "No, thanks for asking. What have you been up to?"], [1, "I have been working on creating a website"], [1, "That's nice"]]
        }
        // var chatObjs = document.getElementsByClassName("chat")
        // for(var i=0; i<chatObjs.length; ++i) {
        //     chatObjs[i].addEventListener("click", loadChat)
        // }
        function loadChat() {
            if(!document.getElementById("chattop") || !document.getElementById("chatmessages") || !document.getElementById("messageinput")) {
                document.getElementById("rightcolumn").innerHTML = `
                <div id="chattop">
                    <img id="profpic" src="chatpage_files/person.png">
                    <p id="personname">Person 2</p>

                </div>
                <div id="chatmessages">
                    
                </div>
            
                <form id="messageinput" method="POST" onsubmit="return addMsg()">
                    <input type="text" id="msginputbox">
                    <input type="submit" value="" id="msgsend">
                </form>
                `
            }
            let name = this.getElementsByClassName("person name")[0].textContent;
            console.log(name);
            current_person_name = document.getElementById("personname");
            current_person_name.textContent = name;
            messages = chats[name];
            chatmessages = document.getElementById("chatmessages");
            chatmessages.innerHTML = "";
            for(var i=0; i<messages.length; ++i) {
                let message = document.createElement("div");
                if(messages[i][0] == 1) {
                    message.className = "message sent";
                }
                else if(messages[i][0] == 2) {
                    message.className = "message received";
                }
                message.textContent = messages[i][1];
                console.log(message)
                chatmessages.appendChild(message);
            }
            chatmessages.scrollTop = chatmessages.scrollHeight;
        }

        function loadChats() {
            let left_column = document.getElementById("leftcolumn");
            for (var key of Object.keys(chats)) {
                console.log(key + " -> " + chats[key])
                let chat = document.createElement("div");
                chat.className = "chat";
                let img = document.createElement("img");
                img.className = "profpic";
                img.src = "chatpage_files/person.png";
                chat.appendChild(img);
                let personnamerecent = document.createElement("div");
                personnamerecent.className = "personnamerecent";
                let personname = document.createElement("p");
                personname.className = "person name";
                personname.textContent = key;
                personnamerecent.appendChild(personname);
                let personrecent = document.createElement("p");
                personrecent.className = "person recentmessage";
                personrecent.textContent = chats[key][chats[key].length-1][1];
                personnamerecent.appendChild(personrecent);
                chat.addEventListener("click", loadChat);
                chat.appendChild(personnamerecent);
                left_column.appendChild(chat);
            }
        }
        loadChats()
    </script>


</body></html>